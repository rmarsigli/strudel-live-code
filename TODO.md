# TODO: Strudel Studio - Roadmap Completo

**In√≠cio**: 2025-10-23
**√öltima An√°lise**: 2025-10-24
**Status Atual**: ‚≠ê **Projeto Nota 88/100** - Pronto para melhorias finais
**Vers√£o Atual**: 1.0.0
**Vers√£o Alvo**: 2.0.0 (ap√≥s melhorias)

> Ver `ANALYSIS.md` para an√°lise completa do projeto

---

## üìä Status Geral do Projeto

### ‚úÖ Conclu√≠do (Fases 1-8)
- [x] Setup e configura√ß√£o base
- [x] TypeScript types e interfaces
- [x] Zustand stores
- [x] Backend WebSocket server
- [x] Componentes core
- [x] Custom hooks
- [x] Integra√ß√£o Strudel
- [x] Visualizador inteligente de c√≥digo

### üéØ Em Andamento
- [ ] Testes (96.2% coverage, mas falta parser/lexer/interpreter)
- [ ] Documenta√ß√£o (README OK, falta CONTRIBUTING.md, CHANGELOG.md)

### üìã Planejado
- [ ] Polimento e UX
- [ ] Build e Deploy
- [ ] Features avan√ßadas (v2.0)

---

## üöÄ MELHORIAS PRIORIT√ÅRIAS (Baseado em ANALYSIS.md)

### üî¥ Alta Prioridade (Para chegar a 95+/100)

#### 1. Adicionar Testes para Parser/Lexer/Interpreter
**Status**: ‚è≥ Pendente
**Tempo estimado**: 4-6 horas
**Prioridade**: CR√çTICA
**Impacto na nota**: +3 pontos

**Arquivos a criar**:
- [ ] `src/lib/strudel-lexer.test.ts`
  - [ ] Testar tokeniza√ß√£o b√°sica
  - [ ] Testar todos os tipos de tokens
  - [ ] Testar edge cases (coment√°rios, strings, n√∫meros)
  - [ ] Coverage alvo: 95%+

- [ ] `src/lib/strudel-parser.test.ts`
  - [ ] Testar parsing de mini-notation
  - [ ] Testar stack, cat, slowcat, fastcat
  - [ ] Testar subgrupos, alternation, euclidean
  - [ ] Testar modifiers (fast, slow, gain, etc)
  - [ ] Testar error handling
  - [ ] Coverage alvo: 95%+

- [ ] `src/lib/strudel-interpreter.test.ts`
  - [ ] Testar gera√ß√£o de eventos
  - [ ] Testar timings corretos
  - [ ] Testar tipos de som
  - [ ] Testar modifiers aplicados
  - [ ] Testar euclidean rhythm
  - [ ] Coverage alvo: 95%+

**Exemplos de testes**:
```typescript
describe('strudel-lexer', () => {
  it('should tokenize basic sound pattern', () => {
    const tokens = tokenize('s("bd sd hh")')
    expect(tokens).toMatchSnapshot()
  })

  it('should handle modifiers', () => {
    const tokens = tokenize('s("bd").fast(2).gain(0.8)')
    expect(tokens[2].type).toBe('FUNCTION')
    expect(tokens[2].value).toBe('fast')
  })
})
```

---

#### 2. Documentar API com JSDoc
**Status**: ‚è≥ Pendente
**Tempo estimado**: 3-4 horas
**Prioridade**: ALTA
**Impacto na nota**: +2 pontos

**Arquivos a documentar**:
- [ ] `src/lib/strudel-lexer.ts`
  ```typescript
  /**
   * Tokenizes Strudel code into an array of tokens
   * @param code - The Strudel code to tokenize
   * @returns Array of tokens representing the code structure
   * @example
   * ```ts
   * const tokens = tokenize('s("bd sd")')
   * // Returns: [{ type: 'FUNCTION', value: 's', ... }, ...]
   * ```
   */
  export function tokenize(code: string): Token[]
  ```

- [ ] `src/lib/strudel-parser.ts`
  ```typescript
  /**
   * Parses tokens into an Abstract Syntax Tree (AST)
   * @param tokens - Array of tokens from lexer
   * @returns PatternNode representing the AST, or null if parsing fails
   * @throws {Error} If tokens are malformed
   */
  export function parse(tokens: Token[]): ParseResult
  ```

- [ ] `src/lib/strudel-interpreter.ts`
  ```typescript
  /**
   * Interprets AST into audio events for visualization
   * @param ast - The pattern AST to interpret
   * @param cps - Cycles per second (tempo)
   * @returns Array of audio events with timing information
   */
  export function interpret(ast: PatternNode | null, cps: number): AudioEvent[]
  ```

- [ ] `src/hooks/use-strudel-visualizer.ts` (package)
- [ ] `src/hooks/use-strudel-engine.ts`
- [ ] `src/hooks/use-websocket.ts`

---

#### 3. Criar CONTRIBUTING.md
**Status**: ‚è≥ Pendente
**Tempo estimado**: 2 horas
**Prioridade**: ALTA
**Impacto na nota**: +2 pontos

**Conte√∫do a incluir**:
- [ ] Como fazer setup do ambiente de desenvolvimento
- [ ] Como rodar o projeto localmente
- [ ] Como rodar os testes
- [ ] Code style e conven√ß√µes (refer√™ncia ao CLAUDE.md)
- [ ] Como criar uma pull request
- [ ] Como reportar bugs
- [ ] Roadmap de features

**Template**:
```markdown
# Contributing to Strudel Studio

## Development Setup

1. Clone the repository
2. Install dependencies: `pnpm install`
3. Copy environment: `cp .env.example .env`
4. Run server: `pnpm run server`
5. Run dev: `pnpm run dev`

## Code Style

See [CLAUDE.md](./CLAUDE.md) for complete code style guide.

- Kebab-case for files
- Single quotes
- No semicolons
- No code comments (use JSDoc)

## Running Tests

...
```

---

#### 4. Criar CHANGELOG.md
**Status**: ‚è≥ Pendente
**Tempo estimado**: 1 hora
**Prioridade**: ALTA
**Impacto na nota**: +1 ponto

**Formato** (Keep a Changelog):
```markdown
# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [1.0.0] - 2025-10-24

### Added
- Live coding music interface with Strudel
- Real-time audio visualization
- WebSocket-based hot reload
- Custom parser/lexer/interpreter for Strudel syntax
- Package @strudel-studio/visualizer (npm-ready)
- 96.2% test coverage
- CI/CD with GitHub Actions

### Fixed
- Audio playback issues
- Visualizer sync with patterns
- Silence handling in parser

...
```

---

### üü° M√©dia Prioridade

#### 5. Testes E2E com Playwright
**Status**: ‚è≥ Pendente
**Tempo estimado**: 6-8 horas
**Prioridade**: M√âDIA

**Setup**:
- [ ] Instalar Playwright: `pnpm add -D @playwright/test`
- [ ] Criar `playwright.config.ts`
- [ ] Criar pasta `e2e/`

**Testes a criar**:
- [ ] `e2e/play-pattern.spec.ts`
  - [ ] Carregar app
  - [ ] Escrever pattern no editor
  - [ ] Clicar em Play
  - [ ] Verificar que visualizador est√° animando
  - [ ] Clicar em Stop

- [ ] `e2e/websocket.spec.ts`
  - [ ] Verificar conex√£o WebSocket
  - [ ] Verificar status indicator (verde)
  - [ ] Simular desconex√£o
  - [ ] Verificar reconex√£o

- [ ] `e2e/keyboard-shortcuts.spec.ts`
  - [ ] Ctrl+Enter para play
  - [ ] Ctrl+. para stop
  - [ ] Verificar que funcionam

**Exemplo**:
```typescript
import { test, expect } from '@playwright/test'

test('should play pattern with Ctrl+Enter', async ({ page }) => {
  await page.goto('http://localhost:5173')
  await page.fill('[data-testid="editor"]', 's("bd sd hh cp")')
  await page.keyboard.press('Control+Enter')
  await expect(page.locator('[data-testid="visualizer"]')).toBeVisible()
})
```

---

#### 6. Configurar Dependabot
**Status**: ‚è≥ Pendente
**Tempo estimado**: 30 minutos
**Prioridade**: M√âDIA

**Arquivo a criar**: `.github/dependabot.yml`
```yaml
version: 2
updates:
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "weekly"
    open-pull-requests-limit: 10

  - package-ecosystem: "npm"
    directory: "/packages/visualizer"
    schedule:
      interval: "weekly"
```

---

#### 7. Feature Flags
**Status**: ‚è≥ Pendente
**Tempo estimado**: 2-3 horas
**Prioridade**: M√âDIA

**Implementa√ß√£o**:
- [ ] Criar `src/lib/feature-flags.ts`
  ```typescript
  export const FEATURES = {
    EXPERIMENTAL_VISUALIZER: import.meta.env.VITE_FEATURE_EXPERIMENTAL_VIZ === 'true',
    AUDIO_CAPTURE: import.meta.env.VITE_FEATURE_AUDIO_CAPTURE === 'true',
    PATTERN_SHARE: import.meta.env.VITE_FEATURE_PATTERN_SHARE === 'true'
  }
  ```

- [ ] Usar em componentes:
  ```typescript
  {FEATURES.EXPERIMENTAL_VISUALIZER && <ExperimentalVisualizer />}
  ```

- [ ] Adicionar em `.env.example`

---

#### 8. Storybook para Componentes UI
**Status**: ‚è≥ Pendente
**Tempo estimado**: 4-6 horas
**Prioridade**: M√âDIA

**Setup**:
- [ ] Instalar Storybook: `npx storybook@latest init`
- [ ] Configurar Vite integration
- [ ] Criar stories para componentes

**Stories a criar**:
- [ ] `src/components/ui/button.stories.tsx`
- [ ] `src/components/ui/input.stories.tsx`
- [ ] `src/components/ui/dialog.stories.tsx`
- [ ] `src/components/control-panel.stories.tsx`
- [ ] `src/components/visualizer.stories.tsx`

---

### üü¢ Baixa Prioridade

#### 9. Branch Protection Rules (GitHub)
**Status**: ‚è≥ Pendente
**Tempo estimado**: 15 minutos
**Prioridade**: BAIXA

**Configurar no GitHub**:
- [ ] Settings ‚Üí Branches ‚Üí Add rule
- [ ] Branch name pattern: `main`
- [ ] Require pull request reviews (1 approval)
- [ ] Require status checks (CI)
- [ ] Require branches to be up to date

---

#### 10. Pull Request Template
**Status**: ‚è≥ Pendente
**Tempo estimado**: 30 minutos
**Prioridade**: BAIXA

**Arquivo a criar**: `.github/pull_request_template.md`
```markdown
## Description
<!-- Describe your changes -->

## Type of Change
- [ ] Bug fix
- [ ] New feature
- [ ] Breaking change
- [ ] Documentation update

## Checklist
- [ ] My code follows the code style (CLAUDE.md)
- [ ] I have added tests
- [ ] All tests are passing
- [ ] I have updated the documentation
```

---

#### 11. Arquivo de Constants Centralizados
**Status**: ‚úÖ J√Å EXISTE
**Arquivo**: `src/lib/constants.ts`

**Melhorias**:
- [ ] Mover mais magic numbers para constants
- [ ] Adicionar documenta√ß√£o JSDoc

---

## ‚úÖ FASE 1-8: COMPLETO

<details>
<summary>Ver detalhes das fases conclu√≠das</summary>

### Fase 1: Setup e Configura√ß√£o Base ‚úÖ
- [x] Projeto Vite + React + TypeScript
- [x] Tailwind CSS
- [x] ESLint + Prettier
- [x] TypeScript strict
- [x] Depend√™ncias instaladas

### Fase 2: TypeScript Types ‚úÖ
- [x] Types em `src/types/`
- [x] Barrel exports

### Fase 3: Zustand Store ‚úÖ
- [x] use-strudel.ts
- [x] use-connection.ts
- [x] use-files.ts
- [x] use-ui.ts

### Fase 4: Backend WebSocket ‚úÖ
- [x] Express + WebSocket server
- [x] File watcher
- [x] Protocolo de mensagens

### Fase 5: Componentes Core ‚úÖ
- [x] Header
- [x] Pattern Editor
- [x] Control Panel
- [x] Visualizer
- [x] UI components (shadcn)

### Fase 6: Custom Hooks ‚úÖ
- [x] use-strudel-engine
- [x] use-websocket
- [x] use-keyboard-shortcuts

### Fase 7: Lib/Utilities ‚úÖ
- [x] Constants
- [x] Validation
- [x] Utils (cn)

### Fase 8: Integra√ß√£o Strudel ‚úÖ
- [x] Auto-init
- [x] Pattern evaluation
- [x] Play/Stop control
- [x] Volume control

</details>

---

## üéØ Fase 9: Testes (Atualizado)

### 9.1 Setup de Testes ‚úÖ
- [x] Vitest configurado
- [x] Testing Library configurado
- [x] Coverage com v8

### 9.2 Testes de Store ‚úÖ
- [x] use-strudel.test.ts
- [x] use-connection.test.ts
- [x] use-files.test.ts
- [x] use-ui.test.ts

### 9.3 Testes de Hooks ‚è≥
- [x] use-strudel-engine (b√°sico)
- [x] use-websocket (b√°sico)
- [ ] use-file-operations (n√£o implementado)
- [x] use-keyboard-shortcuts (b√°sico)

### 9.4 Testes de Componentes ‚è≥
- [x] Button
- [x] Input
- [ ] Header
- [ ] FileBrowser
- [ ] PatternEditor
- [ ] ControlPanel
- [ ] Visualizer

### 9.5 Testes de Parser/Lexer/Interpreter üî¥
- [ ] strudel-lexer.test.ts (CR√çTICO)
- [ ] strudel-parser.test.ts (CR√çTICO)
- [ ] strudel-interpreter.test.ts (CR√çTICO)

### 9.6 Testes E2E üü°
- [ ] Playwright setup
- [ ] Play/Stop flow
- [ ] WebSocket flow
- [ ] Keyboard shortcuts

### 9.7 Cobertura ‚úÖ
- [x] Coverage atual: **96.2%**
- [x] Relat√≥rio HTML gerado
- [x] CI rodando testes

**Meta**: Manter 96%+ ap√≥s adicionar testes de parser

---

## üìñ Fase 10: Documenta√ß√£o (Atualizado)

### 10.1 README.md ‚úÖ
- [x] Introdu√ß√£o
- [x] Features
- [x] Instala√ß√£o
- [x] Como usar
- [x] Screenshots/banner

### 10.2 docs/architecture.md ‚è≥
- [ ] Diagrama de arquitetura
- [ ] Stack tecnol√≥gica
- [ ] Estrutura de pastas
- [ ] Fluxo de dados

### 10.3 docs/websocket-protocol.md ‚è≥
- [ ] Tipos de mensagens
- [ ] Exemplos de payloads
- [ ] Error handling

### 10.4 docs/strudel-integration.md ‚è≥
- [ ] Como @strudel/core √© usado
- [ ] Pattern evaluation
- [ ] Extensibilidade

### 10.5 CONTRIBUTING.md üî¥
- [ ] Como contribuir (ALTA PRIORIDADE)
- [ ] Setup de desenvolvimento
- [ ] Code style
- [ ] Processo de PR

### 10.6 docs/testing.md ‚úÖ
- [x] Como rodar testes
- [x] Estrutura de testes
- [x] Coverage

### 10.7 CHANGELOG.md üî¥
- [ ] Formato Keep a Changelog (ALTA PRIORIDADE)
- [ ] Versionamento sem√¢ntico
- [ ] Release notes

### 10.8 ANALYSIS.md ‚úÖ
- [x] An√°lise completa do projeto (2025-10-24)
- [x] Nota: 88/100
- [x] Breakdown por categoria
- [x] Roadmap de melhorias

---

## üé® Fase 11: Polimento e UX

### 11.1 Anima√ß√µes ‚è≥
- [ ] Fade in/out modais
- [ ] Smooth transitions
- [ ] Loading states

### 11.2 Responsividade ‚è≥
- [ ] Mobile layout
- [ ] Tablet layout
- [ ] Breakpoints

### 11.3 Error Handling ‚úÖ
- [x] WebSocket disconnect
- [x] File operation errors
- [x] Strudel evaluation errors

### 11.4 Loading States ‚è≥
- [ ] Skeleton loaders
- [ ] Spinners
- [ ] Disabled states

### 11.5 Acessibilidade ‚è≥
- [ ] Keyboard navigation
- [ ] ARIA labels
- [ ] Focus indicators
- [ ] Contraste WCAG AA

---

## üöÄ Fase 12: Build e Deploy

### 12.1 Build de Produ√ß√£o ‚úÖ
- [x] Bundle otimizado
- [x] CSS/JS minificado
- [x] Sourcemaps
- [ ] An√°lise de bundle (pendente otimiza√ß√£o)

**Nota**: Bundle atual 855KB (warning Vite). N√£o otimizar agora conforme solicitado.

### 12.2 CI/CD ‚úÖ
- [x] GitHub Actions
- [x] Testes autom√°ticos
- [x] Build autom√°tico
- [x] Type check
- [x] Codecov

### 12.3 Versionamento ‚è≥
- [ ] Tag v1.0.0
- [ ] CHANGELOG.md
- [ ] Release notes

### 12.4 Dependabot üü°
- [ ] Configurar .github/dependabot.yml (M√âDIA PRIORIDADE)

---

## üì¶ Package @strudel-studio/visualizer ‚úÖ

### Status: COMPLETO
- [x] Estrutura de package npm
- [x] Build dual (CJS + ESM)
- [x] TypeScript declarations
- [x] README completo
- [x] PUBLISHING guide
- [x] Zero dependencies
- [x] MIT license
- [x] Build: 29KB (CJS), 28KB (ESM)

### Pr√≥ximos Passos
- [ ] Publicar no npm
- [ ] Adicionar badge npm version
- [ ] Criar exemplos de uso
- [ ] An√°lise profunda da API (TODO.md da package)

---

## üìã Checklist de Qualidade

### C√≥digo ‚úÖ
- [x] Zero erros TypeScript
- [x] Zero erros ESLint
- [x] TypeScript strict mode
- [x] Aspas simples
- [x] Sem ponto e v√≠rgula
- [x] Kebab-case

### Testes ‚è≥
- [x] 96.2% coverage (excelente!)
- [ ] Testes de parser/lexer/interpreter (PENDENTE)
- [ ] Testes E2E (PENDENTE)

### Documenta√ß√£o ‚è≥
- [x] README completo
- [x] ANALYSIS.md criado
- [ ] CONTRIBUTING.md (PENDENTE)
- [ ] CHANGELOG.md (PENDENTE)
- [ ] JSDoc em fun√ß√µes cr√≠ticas (PENDENTE)

### DevOps ‚úÖ
- [x] CI/CD funcionando
- [x] Todos os checks passando
- [x] Coverage report
- [ ] Dependabot (PENDENTE)

---

## üéñÔ∏è M√©tricas de Qualidade

**An√°lise completa em:** `ANALYSIS.md`

| Categoria | Nota | Status |
|-----------|------|--------|
| Arquitetura | 18/20 | ‚úÖ Excelente |
| C√≥digo | 17/20 | ‚úÖ Muito Bom |
| Testes | 16/20 | ‚úÖ Muito Bom |
| Documenta√ß√£o | 15/20 | ‚úÖ Bom |
| DevOps | 20/20 | ‚≠ê Perfeito |
| Features | 18/20 | ‚úÖ Excelente |
| Performance | 17/20 | ‚úÖ Muito Bom |
| Depend√™ncias | 19/20 | ‚úÖ Excelente |
| Git | 18/20 | ‚úÖ Excelente |
| **TOTAL** | **88/100** | ‚≠ê‚≠ê‚≠ê‚≠ê¬Ω |

**Meta**: Chegar a 95+/100 completando as melhorias de Alta Prioridade

---

## üóìÔ∏è Pr√≥ximas Sess√µes

### Sess√£o 1: Testes de Parser (4-6h)
**Prioridade**: üî¥ CR√çTICA
- [ ] Criar strudel-lexer.test.ts
- [ ] Criar strudel-parser.test.ts
- [ ] Criar strudel-interpreter.test.ts
- [ ] Atingir 95%+ coverage

### Sess√£o 2: Documenta√ß√£o (3-4h)
**Prioridade**: üî¥ ALTA
- [ ] Adicionar JSDoc completo
- [ ] Criar CONTRIBUTING.md
- [ ] Criar CHANGELOG.md

### Sess√£o 3: Testes E2E (6-8h)
**Prioridade**: üü° M√âDIA
- [ ] Setup Playwright
- [ ] Criar testes E2E principais
- [ ] Integrar no CI

### Sess√£o 4: Polimento (vari√°vel)
**Prioridade**: üü¢ BAIXA
- [ ] Feature flags
- [ ] Storybook
- [ ] Dependabot
- [ ] PR templates

---

## üìù Log de Altera√ß√µes

### 2025-10-24 (Noite - Sess√£o 5: An√°lise e Roadmap)
- ‚úÖ **CRIADO**: ANALYSIS.md com an√°lise completa do projeto
- ‚úÖ **ATUALIZADO**: TODO.md com roadmap baseado em an√°lise
- ‚úÖ **NOTA DO PROJETO**: 88/100
- ‚úÖ **IDENTIFICADAS**: Melhorias priorit√°rias para chegar a 95+
- ‚úÖ **ORGANIZADO**: Roadmap por prioridade (Alta/M√©dia/Baixa)
- ‚úÖ Todos os erros de CI/CD corrigidos
- ‚úÖ Build passando: lint, tests, type-check, build

### 2025-10-24 (Tarde - Sess√£o 4: Package @strudel-studio/visualizer)
- ‚úÖ **CRIADO**: Package npm separado `@strudel-studio/visualizer`
- ‚úÖ Estrutura completa: parser + lexer + interpreter + hook + componente React
- ‚úÖ TypeScript build configurado com tsup (CJS + ESM + types)
- ‚úÖ README completo com exemplos e API documentation
- ‚úÖ Package pronto para publica√ß√£o no npm
- ‚úÖ .gitignore atualizado para excluir builds
- ‚úÖ Exports: StrudelVisualizer component + useStrudelVisualizer hook + parser utilities
- ‚úÖ Zero dependencies (apenas peerDeps: React 18+)
- ‚úÖ Build bem-sucedido: dist/ gerado com index.js, index.mjs, index.d.ts

### 2025-10-24 (Tarde - Sess√£o 3: Corre√ß√µes Cr√≠ticas)
- ‚úÖ **CORRIGIDO**: Sil√™ncios (`~ ~ ~ ~`) agora n√£o geram barras no visualizador
- ‚úÖ **ADICIONADO**: Suporte para `!` (hold/repeat) - exemplo: `bd:5!2`
- ‚úÖ **ADICIONADO**: Suporte para `.cpm()` modifier
- ‚úÖ Parser refatorado: `s('...')` agora faz mini-notation parsing completo
- ‚úÖ TypeScript compilation: 0 errors

### 2025-10-24 (Tarde - Sess√£o 2)
- ‚úÖ **IMPLEMENTADO**: Visualizador Inteligente de C√≥digo Strudel
- ‚úÖ Criado sistema completo de Lexer ‚Üí Parser ‚Üí Interpreter ‚Üí Visualizer
- ‚úÖ Suporte para todas estruturas de prioridade alta e m√©dia
- ‚úÖ TypeScript compilation: 0 errors

### 2025-10-23
- ‚úÖ TODO.md criado
- ‚úÖ CLAUDE.md criado
- ‚úÖ Projeto inicializado

---

**Estimativa Total Restante**: 15-25 horas
**Complexidade Restante**: üü° M√©dia
**Projeto j√° est√° PRODUCTION-READY**: ‚úÖ Sim

---

**Para mais detalhes, ver:**
- `ANALYSIS.md` - An√°lise completa e breakdown
- `CLAUDE.md` - Regras de c√≥digo
- `README.md` - Como usar o projeto
